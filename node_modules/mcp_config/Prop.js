var esdb = require('easy_db');
var target = 'dev';
var exports = {};

var argv = process.argv;
var kvs = {};
for(var key in argv)
{
    if(key > 1)
    {
        var kv = argv[key].split("=");
        kvs[kv[0]] = kv[1];
    }
}
if(kvs.target)
{
    target = kvs.target;
}

//网关端口
if(kvs.gtPort)
{
    exports.gtPort = kvs.gtPort;
}
else
{
    exports.gtPort = 9081;
}

//runtime target
exports.target = target;

exports.kvs = kvs;

/**
 * 数据库配置信息，
 * config，数据库的连接信息
 * type，类型，暂时支持oracle，mysql，mongodb三种类型
 * dateToLong，ture，则在生成表的时候，会把date类型映射为long类型
 */
var dbs = {
    devLocal:
    {
        config:{host:'localhost',user:'root',password:'123456',port:3306,database:'mcp'},
        type:esdb.prop.dbType.mysql,
        dateToLong:false,
        poolSize:4
    },
    oraLocal:
    {
        config:{hostname: "192.168.11.118",port: 1521,database:"lottery",user: "liming",password: "0okmnhy6"},
        type:esdb.prop.dbType.oracle,
        poolSize:4
    },
    devMg:
    {
        config:{'url':'mongodb://127.0.0.1:27017/mcp'},
        type:esdb.prop.dbType.mongodb
    },
    devCache:
    {
        config:{'url':'mongodb://127.0.0.1:27017/mcp_cache'},
        type:esdb.prop.dbType.mongodb
    },
    runOra:
    {
        config:{hostname: "192.168.222.231",port: 1521,database:"mcp",user: "mcpapp",password: "cde321QAZX"},
        type:esdb.prop.dbType.oracle,
        poolSize:4
    },
    runMg:
    {
        config:{'url':'mongodb://192.168.222.233:27017/mcp'},
        type:esdb.prop.dbType.mongodb
    },
    runCache:
    {
        config:{'url':'mongodb://192.168.222.234:27017/mcp_cache'},
        type:esdb.prop.dbType.mongodb
    },
    yunMysql:
    {
        config:{'host':'10.131.172.66','user':'root','password':'0okmnhy6','port':3306,'database':'mcp'},
        type:esdb.prop.dbType.mysql,
        dateToLong:false,
        poolSize:4
    },
    yunMg:
    {
        config:{'url':'mongodb://10.131.172.66:27017/mcp'},
        type:esdb.prop.dbType.mongodb
    },
    yunCache:
    {
        config:{'url':'mongodb://10.131.172.66:27017/mcp_cache'},
        type:esdb.prop.dbType.mongodb
    }
};
exports.dbs = dbs;

var platform = {};
var printGts = [];  //出票可用端口列表
var outerFilters = [];  //外部系统访问平台的开放地址
var cmdToNew = [];
if(target == 'dev' || target == 'home')
{
    exports.main = dbs.devLocal;
    exports.mg = dbs.devMg;
    exports.cache = dbs.devCache;

    platform.gateways = [{host:'127.0.0.1', port:9090, method:'POST'}
    ];

    //filter层的服务端口
    exports.filterPort = 9090;

    printGts = [
        {host:'127.0.0.1', port:9081, method:'POST'},
        {host:'127.0.0.1', port:9082, method:'POST'}
    ];

    outerFilters = [
        {host:'127.0.0.1', port:9090, method:'POST'}
    ];

    cmdToNew['P12'] = 1;
    cmdToNew['P06'] = 1;
    cmdToNew['P02'] = 1;
    cmdToNew['T03'] = 1;
}
else if(target == 'test')
{
    exports.main = dbs.oraLocal;
    exports.mg = dbs.devMg;
    exports.cache = dbs.devCache;

    platform.gateways = [{host:'127.0.0.1', port:9090, method:'POST'}
    ];

    exports.filterPort = 9090;

    printGts = [
        {host:'127.0.0.1', port:9081, method:'POST'},
        {host:'127.0.0.1', port:9082, method:'POST'}
    ];

    outerFilters = [
        {host:'127.0.0.1', port:9090, method:'POST'}
    ];

    cmdToNew['P12'] = 1;
    cmdToNew['P06'] = 1;
    cmdToNew['P02'] = 1;
    cmdToNew['T03'] = 1;
}
else if(target == 'yun')
{
    exports.main = dbs.yunMysql;
    exports.mg = dbs.yunMg;
    exports.cache = dbs.yunCache;

    platform.gateways = [{host:'127.0.0.1', port:9081, method:'POST'}
    ];

    exports.filterPort = 9090;

    printGts = [
        {host:'127.0.0.1', port:9081, method:'POST'},
        {host:'127.0.0.1', port:9082, method:'POST'}
    ];

    outerFilters = [
        {host:'127.0.0.1', port:9090, method:'POST'}
    ];

    cmdToNew['P12'] = 1;
    cmdToNew['P06'] = 1;
    cmdToNew['P02'] = 1;
}
//线上正式环境，交易使用
else if(target == 'run')
{
    exports.main = dbs.runOra;
    exports.mg = dbs.runMg;
    exports.cache = dbs.runCache;

    platform.gateways = [{host:'192.168.222.233', port:8501, method:'POST'},
        {host:'192.168.222.232', port:8401, method:'POST'},
        {host:'192.168.222.234', port:8601, method:'POST'}
    ];

    exports.filterPort = 9090;

    printGts = [
        {host:'127.0.0.1', port:9081, method:'POST'},
        {host:'127.0.0.1', port:9082, method:'POST'}
    ];

    outerFilters = [
        {host:'192.168.222.234', port:9090, method:'POST'}
    ];

    cmdToNew['P12'] = 1;
    cmdToNew['P06'] = 1;
    cmdToNew['P02'] = 1;
}
//线上正式环境，出票使用
else if(target == 'runprint')
{
    exports.main = dbs.runOra;
    exports.mg = dbs.runMg;
    exports.cache = dbs.runCache;

    platform.gateways = [
        {host:'192.168.222.234', port:8701, method:'POST'}
    ];

    exports.filterPort = 9091;

    printGts = [
        {host:'127.0.0.1', port:9081, method:'POST'},
        {host:'127.0.0.1', port:9082, method:'POST'}
    ];

    outerFilters = [
        {host:'192.168.222.234', port:9091, method:'POST'}
    ];

    cmdToNew['P12'] = 1;
    cmdToNew['P06'] = 1;
    cmdToNew['P02'] = 1;
}

exports.printGts = printGts;
exports.outerFilters = outerFilters;
exports.cmdToNew = cmdToNew;

//暂时支持3种密钥来源
exports.digestFromType = {"NONE":0, "DB":1, "CACHE":2, "FIX":3};
exports.digestFromTypeArray = [
    {id:0, code:'NONE', des:"无"},
    {id:1, code:'DB', des:"数据库"},
    {id:2, code:'CACHE', des:"缓存"},
    {id:3, code:'FIX', des:"缓存固定"}
];

exports.platform = platform;
module.exports = exports;




